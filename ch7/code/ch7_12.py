"""
@BY: Reem Alghamdi
@DATE: 22-10-2020
"""


def chromosome_to_cycle(chromosome):
    nodes = [0] * len(chromosome) * 2
    for j in range(len(chromosome)):
        i = chromosome[j]
        if i > 0:
            nodes[2*j] = 2 * i - 1
            nodes[2*j + 1] = 2 * i
        else:
            nodes[2*j] = -2 * i
            nodes[2*j + 1] = -2 * i - 1
    return nodes


def cycle_to_chromosome(nodes):
    chromosome = [0] * int(len(nodes) / 2)
    for j in range(int(len(nodes)/2)):
        if nodes[2 * j] < nodes[2 * j + 1]:
            chromosome[j] = int(nodes[2 * j + 1] / 2)
        else:
            chromosome[j] = int(-nodes[2 * j] / 2)
    return chromosome


def colored_edges(p):
    # AKA chromosome to edges
    """given a genome p, return the edges colored"""
    edges = []
    for chromosome in p:
        nodes = chromosome_to_cycle(chromosome)
        for j in range(0, len(chromosome)):
            try:
                edges.append([nodes[2 * j + 1], nodes[2 * (j + 1)]])
            except:
                edges.append([nodes[2 * j + 1], nodes[0]])
    return edges


def graph_to_genome(genome_graph):
    # AKA edges to chromosome

    chromosome_array = []
    visited = []
    genome_dictionary = {}
    for edge in genome_graph:
        genome_dictionary[edge[0]] = edge[1]
        genome_dictionary[edge[1]] = edge[0]

    # print(genome_dictionary)
    for edge in genome_graph:
        # print(edge)
        start = edge[0]
        if start not in visited:
            visited.append(start)
            if start % 2 == 0:  # if 4, append 3, if 1, append 2
                end = start - 1
            else:
                end = start + 1
            chromosome = []
            i = 0
            while True:  # do while until I find the end of cycle
                # print("s", start)
                # print("e", end)
                if start % 2 == 0:
                    chromosome.append(int(start / 2))
                else:
                    chromosome.append(-int(start / 2 + 1))
                dest = genome_dictionary[start]
                # print("d", dest)
                i = i + 1
                visited.append(dest)
                # print("p", chromosome)
                if dest == end:
                    chromosome_array.append(chromosome)  # end of cycle!
                    break
                if dest % 2 == 0:
                    start = dest - 1
                else:
                    start = dest + 1
                visited.append(start)
    return chromosome_array


def string_to_chromosome(string_chromosome):
    """
    given the string "(+1 -2 -3 +4)", turn it into the array [+1 -2 -3 +4]
    """
    return [int(x) for x in string_chromosome[1:-1].split()]


def chromosome_to_string(chromosome):
    return "(" + ' '.join(['{0:+d}'.format(j) for j in chromosome]) + ")"


def string_to_edges(string):
    return [list(eval(x)) for x in string.replace("), ", ")S").split("S")]


def edges_to_string(genome):
    return ', '.join([str(tuple(x)) for x in genome])


def cycle_to_string(cycle):
    return "(" + ' '.join(map(str, cycle)) + ")"


def string_to_chromosome_array(string):
    return [string_to_chromosome(x) for x in string.replace(")", ")S").split("S")[:-1]]


def chromosome_array_to_string(chromosome_array):
    string = ""
    for out in chromosome_array:
        string += chromosome_to_string(out)
    return string


if __name__ == "__main__":
    # print(string_to_chromosome("(+1 -2 -3 +4)"))
    # string = "(+1 -2 -3 +4)"
    # string = "(+1 -2 -3 +4 +5 -6 +7 -8 +9 +10 +11 -12 +13 +14 +15 +16 +17 +18 -19 +20 -21 -22 -23 +24 +25 -26 -27 -28 -29 +30 -31 -32 +33 -34 +35 -36 +37 -38 +39 -40 +41 +42 -43 -44 -45 +46 -47 -48 -49 +50 +51 +52 +53 -54 -55 +56 +57 -58 +59 -60 +61 +62 -63 -64 -65 +66 +67 +68 +69)"
    # out = chromosome_to_cycle(string_to_chromosome(string))
    # print(cycle_to_string(out))

    # string = "(1 2 4 3 6 5 7 8)"
    # string = "(2 1 4 3 5 6 7 8 9 10 11 12 13 14 16 15 17 18 20 19 22 21 24 23 25 26 27 28 29 30 32 31 33 34 36 35 38 37 40 39 42 41 44 43 45 46 47 48 50 49 52 51 54 53 56 55 58 57 59 60 62 61 64 63 65 66 67 68 69 70 71 72 73 74 76 75 77 78 80 79 81 82 83 84 85 86 87 88 90 89 92 91 93 94 95 96 98 97 100 99 102 101 103 104 105 106 108 107 109 110 111 112 113 114 116 115 117 118 120 119 121 122 124 123 126 125)"
    # out = cycle_to_chromosome(string_to_chromosome(string))
    # print(chromosome_to_string(out))

    # string = "(+1 -2 -3)(+4 +5 -6)"
    # string = "(+1 -2 +3 +4 +5 +6 +7 +8 -9 +10 -11 -12 -13 -14 -15 -16 -17 +18 -19 -20 +21 +22 +23 +24 -25 -26 +27 +28 -29 -30)(-31 +32 -33 +34 +35 -36 +37 -38 +39 +40 +41 -42 -43 -44 -45 +46 +47 -48 +49 -50 +51 +52 +53 -54 -55 -56)(-57 +58 +59 +60 -61 -62 +63 +64 +65 +66 -67 +68 -69 +70 +71 -72 -73 +74 -75 -76 +77 +78 +79 -80 -81 -82 -83 +84 +85 -86 -87)(+88 -89 -90 +91 -92 -93 -94 +95 +96 -97 -98 -99 +100 -101 -102 -103 -104 +105 +106 +107 +108 +109 +110)(-111 +112 -113 +114 -115 +116 +117 -118 +119 +120 -121 +122 +123 -124 -125 -126 +127 -128 -129 -130 +131 -132 -133 -134 -135 -136 +137)(-138 +139 +140 +141 -142 +143 +144 +145 -146 -147 +148 +149 +150 +151 -152 -153 -154 -155 -156 +157 -158 +159 +160 -161 +162 -163 +164 -165 -166)(+167 -168 +169 -170 -171 -172 -173 +174 -175 +176 -177 +178 +179 -180 -181 -182 -183 +184 -185 +186 -187 -188 +189)(-190 +191 +192 -193 +194 +195 -196 +197 -198 -199 -200 +201 +202 +203 -204 -205 -206 +207 -208 -209 -210 -211 -212 -213 +214)(-215 +216 -217 +218 +219 -220 -221 +222 +223 -224 +225 +226 -227 +228 -229 +230 -231 +232 +233 -234 -235 -236 -237 +238 +239 +240 +241 -242 +243)"
    # chromosome_array = string_to_chromosome_array(string)
    # out = colored_edges(chromosome_array)
    # print(edges_to_string(out))

    string_edges = "(2, 4), (3, 6), (5, 1), (7, 9), (10, 12), (11, 8)"
    # print(edges_to_cycles(string_to_edges(string_edges)))
    # # string_edges = "(2, 3), (4, 6), (5, 7), (8, 10), (9, 12), (11, 13), (14, 15), (16, 18), (17, 19), (20, 22), (21, 24), (23, 25), (26, 28), (27, 30), (29, 31), (32, 34), (33, 35), (36, 38), (37, 40), (39, 42), (41, 43), (44, 45), (46, 48), (47, 50), (49, 52), (51, 54), (53, 56), (55, 58), (57, 60), (59, 1), (61, 63), (64, 66), (65, 68), (67, 69), (70, 71), (72, 74), (73, 76), (75, 78), (77, 80), (79, 82), (81, 83), (84, 85), (86, 87), (88, 90), (89, 92), (91, 93), (94, 96), (95, 98), (97, 100), (99, 101), (102, 103), (104, 106), (105, 108), (107, 109), (110, 111), (112, 62), (113, 116), (115, 118), (117, 119), (120, 122), (121, 123), (124, 125), (126, 128), (127, 130), (129, 132), (131, 134), (133, 135), (136, 138), (137, 140), (139, 142), (141, 144), (143, 145), (146, 147), (148, 149), (150, 151), (152, 153), (154, 156), (155, 158), (157, 160), (159, 161), (162, 163), (164, 165), (166, 114), (167, 169), (170, 171), (172, 173), (174, 176), (175, 177), (178, 179), (180, 182), (181, 183), (184, 186), (185, 187), (188, 189), (190, 191), (192, 193), (194, 196), (195, 198), (197, 200), (199, 202), (201, 203), (204, 205), (206, 208), (207, 209), (210, 168), (211, 214), (213, 215), (216, 218), (217, 220), (219, 222), (221, 224), (223, 226), (225, 227), (228, 229), (230, 231), (232, 234), (233, 236), (235, 237), (238, 239), (240, 242), (241, 244), (243, 246), (245, 247), (248, 249), (250, 251), (252, 253), (254, 256), (255, 258), (257, 260), (259, 212), (261, 264), (263, 266), (265, 267), (268, 269), (270, 272), (271, 273), (274, 275), (276, 278), (277, 279), (280, 281), (282, 283), (284, 285), (286, 287), (288, 290), (289, 291), (292, 293), (294, 295), (296, 297), (298, 300), (299, 302), (301, 303), (304, 262), (306, 307), (308, 309), (310, 312), (311, 313), (314, 316), (315, 318), (317, 320), (319, 321), (322, 323), (324, 325), (326, 327), (328, 329), (330, 332), (331, 333), (334, 336), (335, 338), (337, 340), (339, 342), (341, 344), (343, 346), (345, 348), (347, 305)"
    # print(string_to_edges(string_edges))
    # string_edges = '(2, 3), (4, 6), (5, 8), (7, 10), (9, 12), (11, 14), (13, 16), (15, 18), (17, 19), (20, 22), (21, 24), (23, 26), (25, 28), (27, 30), (29, 32), (31, 34), (33, 35), (36, 37), (38, 39), (40, 41), (42, 43), (44, 1), (46, 48), (47, 49), (50, 51), (52, 53), (54, 56), (55, 57), (58, 59), (60, 62), (61, 64), (63, 65), (66, 68), (67, 69), (70, 72), (71, 73), (74, 76), (75, 78), (77, 79), (80, 81), (82, 83), (84, 86), (85, 88), (87, 89), (90, 91), (92, 94), (93, 96), (95, 45), (97, 99), (100, 101), (102, 103), (104, 106), (105, 107), (108, 109), (110, 112), (111, 113), (114, 116), (115, 117), (118, 120), (119, 122), (121, 124), (123, 125), (126, 127), (128, 130), (129, 131), (132, 133), (134, 135), (136, 137), (138, 140), (139, 141), (142, 98), (143, 146), (145, 147), (148, 150), (149, 151), (152, 153), (154, 156), (155, 158), (157, 160), (159, 161), (162, 164), (163, 165), (166, 167), (168, 169), (170, 171), (172, 174), (173, 176), (175, 177), (178, 180), (179, 181), (182, 183), (184, 186), (185, 188), (187, 189), (190, 191), (192, 194), (193, 195), (196, 198), (197, 199), (200, 202), (201, 144), (204, 205), (206, 207), (208, 209), (210, 211), (212, 213), (214, 216), (215, 217), (218, 220), (219, 222), (221, 223), (224, 226), (225, 227), (228, 229), (230, 232), (231, 234), (233, 236), (235, 237), (238, 240), (239, 242), (241, 243), (244, 246), (245, 247), (248, 249), (250, 252), (251, 253), (254, 256), (255, 203), (258, 260), (259, 262), (261, 264), (263, 265), (266, 267), (268, 270), (269, 272), (271, 273), (274, 275), (276, 277), (278, 280), (279, 282), (281, 283), (284, 286), (285, 287), (288, 290), (289, 291), (292, 293), (294, 295), (296, 298), (297, 300), (299, 301), (302, 257), (304, 305), (306, 307), (308, 309), (310, 311), (312, 314), (313, 315), (316, 318), (317, 320), (319, 321), (322, 323), (324, 326), (325, 327), (328, 329), (330, 332), (331, 334), (333, 336), (335, 338), (337, 339), (340, 342), (341, 303), (343, 346), (345, 348), (347, 350), (349, 351), (352, 353), (354, 356), (355, 357), (358, 360), (359, 362), (361, 364), (363, 365), (366, 367), (368, 370), (369, 372), (371, 373), (374, 375), (376, 378), (377, 379), (380, 382), (381, 383), (384, 344), (385, 388), (387, 389), (390, 392), (391, 394), (393, 395), (396, 398), (397, 400), (399, 402), (401, 403), (404, 406), (405, 408), (407, 409), (410, 411), (412, 414), (413, 416), (415, 417), (418, 419), (420, 421), (422, 424), (423, 425), (426, 428), (427, 386)'
    chromosomes = graph_to_genome(string_to_edges(string_edges))
    print(chromosome_array_to_string(chromosomes))
